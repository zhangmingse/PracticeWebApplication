<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

	<div>
		<input type="submit" value="GetBase64" onclick="start_get_base64()" />
		<input type="submit" value="GetBinary" onclick="start_get_binary()" />
	</div>
	<div id="messages"></div>
	<img id="imagebase64"></img>
	<canvas id="imagecanvas" width="1500" height="1000">Your browser does not support the HTML5 canvas tag </canvas>
	<script type="text/javascript">
		var imagecanvas = document.getElementById("imagecanvas");
		var ctx = imagecanvas.getContext("2d");
		var total_experiment_round = 99;
		var current_experiment_round = 0;
		var current_type = 1;//1:base64;2:binary

		var image = new Image();
		image.onload = function() {
			mydate = new Date();
			t2 = mydate.getTime();
			ctx.drawImage(image, 0, 0);
			mydate = new Date();
			t3 = mydate.getTime();
			//console.log(t1 +"  "+t2+"  "+t3);
			console.log((t2-t1) + "      index : " + current_experiment_round);
			//console.log("=======================");
			if(current_experiment_round < total_experiment_round){
				if(current_type == 1){
					setTimeout(function(){getbase64()},100);
				}else{
					setTimeout(function(){getbinary()},100);
				}
				
				
				current_experiment_round = current_experiment_round + 1;
			}
			
		}

		var webSocket = new WebSocket(
				'ws://192.168.1.103:8080/PraticeWebApplication/websocket');

		webSocket.onerror = function(event) {
			onError(event)
		};

		webSocket.onopen = function(event) {
			onOpen(event)
		};

		webSocket.onmessage = function(event) {
			onMessage(event)
		};

		
		var t1 = 0;
		var t2 = 0;
		var t3 = 0;
		var mydate = new Date();
		function onMessage(event) {

			
			// 	     document.getElementById('messages').innerHTML 
			//    	    += '<br />' + event.data;
			//document.getElementById('imagebase64').src = 'data:image/png;base64,'+event.data;
			if(typeof(event.data) == "string"){
				
				image.src = 'data:image/png;base64,' + event.data;	
			}else{
				var reader = new FileReader();
				reader.onload = function(event){
					if(event.target.readyState == FileReader.DONE){
						var url = event.target.result;
						image.src = url;
					}
				}
				
				reader.readAsDataURL(event.data);
			}
			

		}

		function onOpen(event) {
			document.getElementById('messages').innerHTML = 'Connection established';
		}

		function onError(event) {
			alert(event.data);
		}

		function start_get_base64(){
			current_experiment_round = 0;
			current_type = 1;//base64
			getbase64();
			return false;
		}
		function getbase64() {
			mydate = new Date();
			t1 = mydate.getTime();
			webSocket.send('base64');
			return false;
		}
		function start_get_binary(){
			current_experiment_round = 0;
			current_type = 2 ;//binary
			getbinary();
			return false;
		}
		function getbinary() {
			mydate = new Date();
			t1 = mydate.getTime();
			webSocket.send('binary');
		}
	</script>
</body>
</html>